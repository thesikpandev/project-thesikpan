# NICEPAY CMS 관리 시스템 사용 가이드

## 🚀 시작하기

### 1. 서버 실행

```bash
# 1. Mock 서버 실행 (터미널 1)
npm run mock:server

# 2. Next.js 앱 실행 (터미널 2)
npm run dev
```

### 2. 접속
브라우저에서 http://localhost:3000/nicepay 또는 http://localhost:3001/nicepay 접속

## 📱 주요 기능

### 1. 대시보드 (`/nicepay`)
- 전체 회원 수, 활성 회원, 대기중 출금, 완료된 출금 통계
- 최근 활동 내역
- 빠른 작업 버튼

### 2. 회원 관리 (`/nicepay/members`)

#### 회원 목록 보기
- 등록된 모든 회원 조회
- 회원 상태 확인 (등록대기, 정상, 실패, 해지)
- 상세 정보 보기 및 삭제

#### 새 회원 등록 (`/nicepay/members/new`)
1. **서비스 타입 선택**
   - 계좌 출금: 은행 계좌 정보 입력
   - 카드 결제: 카드 정보 입력

2. **필수 정보 입력**
   - 회원 ID (20자 이내, 언더바와 하이픈만 허용)
   - 회원명
   - 휴대폰 번호

3. **계좌 출금 선택 시**
   - 은행 선택
   - 계좌번호
   - 예금주명
   - 생년월일(6자리) 또는 사업자번호(10자리)

4. **카드 결제 선택 시**
   - 카드번호 (16자리)
   - 유효기간 (YYMM 형식)

5. **선택 정보**
   - 이메일
   - 서비스명
   - 현금영수증 설정

### 3. 출금 관리 (`/nicepay/payments`)

#### 출금 목록 보기
- 모든 출금 요청 조회
- 상태별 필터링 (대기중, 성공, 실패, 취소)
- 출금 통계 (오늘, 이번 주, 이번 달)

#### 새 출금 요청 (`/nicepay/payments/new`)
1. **회원 선택**: 활성 회원 중 선택
2. **출금 정보 입력**:
   - 출금 요청일 (D-1 17시까지 등록 필요)
   - 출금 금액
   - 통장 표시 내용 (선택)
   - 현금영수증 발행 여부

3. **분할 입금 (선택)**:
   - 여러 계좌로 분할 입금 설정
   - 항목코드와 금액 입력
   - 합계가 출금 금액과 일치해야 함

#### 출금 작업
- **상세 보기**: 출금 상세 정보 확인
- **취소**: 카드 결제만 가능
- **삭제**: 대기중인 출금만 가능

### 4. 정산 캘린더 (`/nicepay/calendar`)

#### 캘린더 기능
- 월별 영업일/휴일 표시
- 날짜 클릭으로 상세 정산 정보 확인

#### 정산 정보
- **출금 정보**:
  - 등록 마감 시간 (D-1 17:00)
  - 은행 정산일 (D+2 영업일)
  - 카드 정산일 (D+1 영업일)

- **회원등록 정보**:
  - 처리일 (12시 기준)
  - 결과 확인 가능 시간

- **비즈니스 규칙**:
  - 회원등록 처리 시간
  - 출금 요청 마감 시간
  - 결과 확인 가능 시간

## 💡 사용 팁

### Mock 서버 테스트
1. **자동 상태 변경**: 
   - 회원등록 후 20분 뒤 자동으로 "정상" 상태로 변경
   - 출금요청 후 20분 뒤 자동으로 "성공" 상태로 변경

2. **테스트 데이터**:
   - Mock 서버 시작 시 자동으로 테스트 회원 2명 생성
   - 테스트 출금 2건 생성

### 주요 비즈니스 규칙

#### 회원등록
- **12시 이전 등록**: 당일 처리, 익영업일 13시 결과
- **12시 이후 등록**: 익영업일 처리, 익익영업일 13시 결과

#### 출금요청
- **등록 마감**: D-1일 17시
- **은행 출금**: D+1일 13시 결과 확인
- **카드 결제**: 당일 승인, D+1일 13시 수수료 확인

#### 정산
- **은행**: D+2 영업일
- **카드**: D+1 영업일

## 🔧 문제 해결

### Mock 서버 연결 오류
```bash
# Mock 서버가 실행 중인지 확인
lsof -i :7080

# 포트가 사용 중이면 프로세스 종료
kill -9 <PID>

# Mock 서버 재시작
npm run mock:server
```

### Next.js 서버 오류
```bash
# 개발 서버 재시작
npm run dev

# 포트 3000이 사용 중이면 3001로 자동 변경됨
```

## 📝 API 엔드포인트

Mock 서버는 다음 엔드포인트를 제공합니다:

- **회원 관리**: `http://localhost:7080/thebill/retailers/30000000/members/{memberId}`
- **출금 관리**: `http://localhost:7080/thebill/retailers/30000000/payments/{date}/{messageNo}`
- **정산 조회**: `http://localhost:7080/thebill/retailers/30000000/settlements/due-date`

## 🎯 테스트 시나리오

### 시나리오 1: 회원 등록 및 출금
1. `/nicepay/members/new`에서 새 회원 등록
2. 20분 대기 (또는 Mock 서버 재시작으로 즉시 활성화)
3. `/nicepay/payments/new`에서 해당 회원으로 출금 요청
4. `/nicepay/payments`에서 출금 상태 확인

### 시나리오 2: 정산 일정 확인
1. `/nicepay/calendar`에서 오늘 날짜 클릭
2. 출금 등록 마감 시간 확인
3. 정산 예정일 확인
4. 다른 날짜 클릭하여 비교

### 시나리오 3: 카드 결제 취소
1. 카드 회원 등록
2. 카드 출금 요청
3. 20분 후 승인 완료 확인
4. 취소 버튼으로 결제 취소

## 🚨 주의사항

1. **Mock 서버는 개발용**: 실제 결제는 처리되지 않음
2. **데이터는 메모리에 저장**: 서버 재시작 시 초기화
3. **시간 시뮬레이션**: 실제보다 빠르게 처리 (20분)
4. **API Key**: 테스트용 키 사용 중 (실제 운영 시 변경 필요)